<IfModule mod_rewrite.c>

    RewriteEngine On

    # Imposta la base per le riscritture se il progetto è in una sottodirectory del dominio
    # Se il tuo progetto è in http://tuodominio.com/fm/, allora RewriteBase dovrebbe essere /fm/
    # Se è nella root del dominio (http://tuodominio.com/), puoi commentare o usare RewriteBase /
    RewriteBase /

    # Ignora le richieste per file e directory esistenti (per assets, ecc.)
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]

    # Regole di riscrittura specifiche (esempi, da espandere)
    # Pagine di autenticazione
    RewriteRule ^login/?$ login.php [L,QSA]
    RewriteRule ^registrati/?$ register.php [L,QSA]
    RewriteRule ^logout/?$ logout.php [L,QSA]
    RewriteRule ^cambia-password/?$ change_password.php [L,QSA]
    RewriteRule ^valida-email/?$ validate_user_email.php [L,QSA]
    RewriteRule ^valida-cambio-email/?$ validate_email_change.php [L,QSA]
    RewriteRule ^password-dimenticata/?$ forgot_password.php [L,QSA]
    RewriteRule ^reset-password/?$ reset_password.php [L,QSA] # Per la pagina di reset effettivo
	RewriteRule ^modifica-profilo/?$ edit_profile.php [L,QSA]

    # Visualizzazione File Utente
    RewriteRule ^i-miei-file/?$ my_files.php?folder_id=0 [L,QSA]
    RewriteRule ^cartella/(\d*)/?$ my_files.php?folder_id=$1 [L,QSA] # \d* permette ID numerico o vuoto (che diventa folder_id='')
    
    # Modifica file utente
    RewriteRule ^file/modifica/(\d+)/?$ edit_file.php?file_id=$1 [L,QSA]
    
    # Upload
    RewriteRule ^upload/?$ upload.php?folder_id=0 [L,QSA] # Upload in radice
    RewriteRule ^upload/in/cartella/(\d+)/?$ upload.php?folder_id=$1 [L,QSA]

    # Download
    RewriteRule ^download/file/(\d+)/?$ download.php?file_id=$1 [L,QSA]
    RewriteRule ^download/pubblico/([a-zA-Z0-9]+)/?$ public_download.php?token=$1 [L,QSA]

    # Azioni Admin
    RewriteRule ^admin/?$ index.php [L,QSA] # La dashboard admin è index.php quando admin loggato
    RewriteRule ^admin/utenti-pendenti/?$ admin_pending_users.php [L,QSA]
    RewriteRule ^admin/utenti/?$ admin_users.php [L,QSA]
    RewriteRule ^admin/utenti/modifica/(\d+)/?$ admin_users.php?action=edit&user_id=$1 [L,QSA]
    RewriteRule ^admin/cartelle/?$ admin_folders.php [L,QSA]
    RewriteRule ^admin/cartelle/gestisci/(\d+)/?$ admin_manage_folder.php?folder_id=$1 [L,QSA]
    RewriteRule ^admin/file-manager/?$ admin_files.php [L,QSA] # Pagina gestione globale file
    RewriteRule ^admin/impostazioni/?$ admin_settings.php [L,QSA]
    
    # Gestione eliminazione file (se delete_file.php è uno script di azione)
    # Questi script di solito ricevono POST, ma la regola può aiutare se ci fossero link diretti o per uniformità
    RewriteRule ^file/elimina/?$ delete_file.php [L,QSA]

    # Fallback: se nessuna regola sopra matcha, e non è un file/dir esistente,
    # potresti voler reindirizzare a index.php o mostrare un 404 personalizzato.
    # Per ora, lasciamo che Apache gestisca i 404 se nessuna regola matcha.
    # RewriteRule ^index\.php$ - [L] # Non riscrivere index.php stesso
    # RewriteCond %{REQUEST_FILENAME} !-f
    # RewriteCond %{REQUEST_FILENAME} !-d
    # RewriteRule . index.php [L] # Esempio di fallback a index.php (controller principale)

</IfModule>